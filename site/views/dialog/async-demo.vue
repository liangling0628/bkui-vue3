<template>
  <div>
    <bk-button @click="() => (exampleSetting.isShow = true)"> 异步关闭 </bk-button>
    <bk-dialog
      :confirm-text="exampleSetting.confirmText"
      :is-loading="exampleSetting.loading"
      :is-show="exampleSetting.isShow"
      :theme="'primary'"
      :title="'文本标题'"
      @closed="() => (exampleSetting.isShow = false)"
      @confirm="handleConfirm"
      @value-change="valueChange"
    >
      <div>点击确定后 {{ exampleSetting.countdown }} 秒关闭</div>
    </bk-dialog>
  </div>
</template>

<script setup>
  import { ref } from 'vue';

  import BkButton from '@bkui-vue/button';
  import BkDialog from '@bkui-vue/dialog';

  const exampleSetting = ref({
    isShow: false,
    loading: false,
    countdown: 3,
    timer: null,
    confirmText: '确定',
  });

  const handleConfirm = () => {
    exampleSetting.value.loading = true;
    exampleSetting.value.timer = setInterval(() => {
      exampleSetting.value.countdown -= 1;
      if (exampleSetting.value.countdown === 0) {
        exampleSetting.value.isShow = false;
        clearInterval(exampleSetting.value.timer);
      }
    }, 1000);
  };

  const valueChange = val => {
    if (!val) {
      clearInterval(exampleSetting.value.timer);
      exampleSetting.value.loading = false;
      exampleSetting.value.countdown = 3;
    }
  };
</script>
